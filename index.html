<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="https://code.jquery.com/jquery-3.6.1.js" integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI=" crossorigin="anonymous"></script>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
	<title>AI-Drawing-Spell-Generator-web</title>
</head>
<body>
<h1>AI-Drawing-Spell-Generator-web</h1>
請先載入資料包<br><input type="file" id="fileInput" accept=".json">
<hr>
<h3>輸入要找的字詞</h3>
<input type="text" id="input_show" list="options" size="30">
<datalist id="options">
</datalist>
<br>
<h3>tag_word</h3>
<textarea rows="5" cols="40" class='tag' style='resize:none;' readonly></textarea>
<button class='add_word'>加入</button><br>

<hr>
<h3>成果</h3>
<button class='clear'>clear</button>
<button class='copy'>copy</button>
<button class='uquote'>{ }to( )</button>
<button class='quote'>( )to{ }</button>
<br><br>
<textarea rows="5" cols="60" class='result' style='resize:none;width:80%'></textarea>
<script>
	var json_data;
	var index_data_n=0;
	function json_data_in_list()
	{	//載入json程式
		//先清空
		$("#options").empty();
		index_data_n=0;
		json_data.forEach(function(c){
			var name=c['Category_Name'];
			c['data'].forEach(function(tag){
				$("#options").append("<option value='"+name+"-"+tag[0]+"-"+index_data_n+"' data-value='"+tag[1]+"'>"+tag[1]+"</option>");
				index_data_n=index_data_n+1;
			})
		});
	}
	$('.uquote').on('click',function(){
		var result=$('.result').val();
		result=result.replace(/\{/g,"(")
		result=result.replace(/\}/g,")")
		//console.log(result);
		$('.result').val(result);
	});
	$('.quote').on('click',function(){
		var result=$('.result').val();
		result=result.replace(/\(/g,"{")
		result=result.replace(/\)/g,"}")
		//console.log(result);
		$('.result').val(result);
	});
	$('.clear').on('click',function(){
		$('.result').val('');
	});
	$('.copy').on('click',function(){
		var content = $('.result');
		content.select();
		document.execCommand('copy');
		alert('copy to clipboard');
	});
	$('#input_show').on('change',function(){
		//顯示tag名稱
		var val = $('#input_show').val();
		var value = $('#options option').filter(function() {
			return this.value == val;
		}).data('value');
		$('.tag').val(value);
	});
	$('.add_word').on('click',function(){
		//文字加到result
		var result = $('.result').val();
		if(result=='')
		{
			//result為空
			$('.result').val($('.tag').val());
		}
		else
		{
			//result不為空
			var rule=$('.tag').val();
			if(result.search(rule)==-1)
			{
				$('.result').val(result+","+$('.tag').val());
			}
			else
			{
				result=result.replace($('.tag').val(), "("+$('.tag').val()+")");
				$('.result').val(result);
				//alert("重復");
			}
		}
	});
	$('#fileInput').change(function(){
		//讀取json
	  if (this.files.length === 0) {
		//console.log('請選擇文件！');
		alert("請選擇json文件");
		return;
	  }
	  const reader = new FileReader();
	  reader.onload = function fileReadCompleted() {
		try
		{
			json_data=JSON.parse(reader.result);
			json_data_in_list();
			alert('載入成功！！\n共載入'+(index_data_n)+'個tag');
		}
		catch(e)
		{
			alert("解析json失敗，請確認是否為json檔");
		}

	  };
	  reader.readAsText(this.files[0]);
	});
</script>
</body>
</html>